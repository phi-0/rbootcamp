---
title: "R-Bootcamp Analysis - Rental Bike Behaviour Seoul"
author: Konstantinos Lessis, Pascal Himmelberger
date: 08/09/2020
output: html_notebook
---
<center>
![Bike Rental](./img/rental.jpg)
</center>

# Background

```{r}

```

# Setup & Data Load

```{r}
# load packages
library(readxl)
library(ggplot2)
require(knitr)

# Setting locale
Sys.setlocale("LC_ALL", 'German_Switzerland')

# Set working directory
nodename <- Sys.info()['nodename'] #Get OS name for dynamic working directory setting

if (grepl('SKYLLA', nodename)){   # Pascal Workstation
  opts_knit$set(root.dir = "G:/Dev/DataScience/RBootcamp/Group_Work/")
  setwd("G:/Dev/DataScience/RBootcamp/Group_Work/")
} else if (grepl('ARES', nodename)) {   # Pascal Laptop
  opts_knit$set(root.dir = "C:/Documents/Google Drive/mlm - Applied Machine Learning & Predictive Modelling")
  setwd("C:/Documents/Google Drive/mlm - Applied Machine Learning & Predictive Modelling")
} else if (grepl('Phoenix.local', nodename)) {    # COSTA
  opts_knit$set(root.dir = "~/ML1/mlm - Applied Machine Learning & Predictive Modelling")
}else {

}

# Get rental data
bikedata.source <- read.csv2('./source/bikesharing/SeoulBikeData.csv', sep=c(','))
str(bikedata.source)
```
As the output above shows, the bike rental data from Seoul (source: https://archive.ics.uci.edu/ml/datasets/Seoul+Bike+Sharing+Demand) contains over 8700 observations and 14 variables or attributes. This includes hourly number of bike rentals including meteorological information - such as humidity, temperature, rainfall etc. -  as well as 'holiday' indicators.
R tried to automatically determine the data types of our attributes but mis-categorized some. All attributes will be cast to their required data type in the next step (**Data Transformation**).

```{r}
setwd('G:/Dev/DataScience/RBootcamp/Group_Work/')
# Get airport arrival data 2017 & 2018
air17.source <- read_excel('./source/bikesharing/Airport_Statistics_Stat_by_Time_of_Day_201701_201712_edited.xls', sheet = 1)
air18.source <- read_excel('./source/bikesharing/Airport_Statistics_Stat_by_Time_of_Day_201801_201812_edited.xls', sheet = 1)
str(air17.source) #str(air18.source) # same as air17 but for year 2018

```
In addition to the above bike rental data set, we will employ data from the Incheon Airport Seoul (source: https://www.airport.kr/co/en/cpr/statisticCategoryOfTime.do) which lists the total number of passengers (arrivals) for 2017 and 2018, grouped by hour of the day. This grouping was chosen due to the fact that the available bike data is also grouped on an hourly basis.


# Data Transformation

* casting data to correct types especially
    + factors
    + date/time
    + numeric values (int, double)
* remove invalid values / corrupted lines
* standardise missing values / NAs
* add computed / derived columns such as
    + hour extracted from field 'time' in air dataset to link to bike data
    + relative number of passengers per hour in air dataset
* combine both datasets

Let us start with the rental bike dataset. Below we will cast the attributes to their most appropriate type. Potential issues with missing / invalid data should be revealed during that process.

### Casting of Data Types

```{r}
# creating cleaned version of source data with correctly cast data types for each attribute
bikedata.c <- data.frame(
    Date =          as.Date(bikedata.source$Date, format='%d/%m/%Y'),
    RentCount =     bikedata.source$Rented.Bike.Count,
    Hour =          bikedata.source$Hour,
    Temperature =   as.double(bikedata.source$Temperature..C., length = 1),
    Humidity =      bikedata.source$Humidity...,
    Windspeed =     as.double(bikedata.source$Wind.speed..m.s., length = 1),
    Visibility =    bikedata.source$Visibility..10m.,
    DewPointTemp =  as.double(bikedata.source$Dew.point.temperature..C., length = 2),
    SolarRadiation= as.double(bikedata.source$Solar.Radiation..MJ.m2., length = 1),
    Rainfall =      as.double(bikedata.source$Rainfall.mm., length = 1),
    Snowfall =      as.double(bikedata.source$Snowfall..cm., length = 1),
    Season =        factor(bikedata.source$Seasons),
    Holiday =       factor(bikedata.source$Holiday),
    Functional =    factor(bikedata.source$Functioning.Day)
)
# check
str(bikedata.c)

```

The casting did not show any problems with invalid data / missing values so no removal / cleanup of that dataset seems to be necessary at this point. Therefore, we will continue with the two air passenger datasets for Incheon Airport. This dataset is split by year. After casting all attributes to appropriate data types, the two data sets (2017 and 2018) will be combined into one dataframe with the addition of a *year* attribute.

```{r}
# before going further, we need to remove the 'TOTAL' row from the data set
air17.edit <- air17.source[air17.source$time != 'Total',]
air18.edit <- air18.source[air18.source$time != 'Total',]

# 2017 air passenger data Seoul
air17.c <- data.frame(
    Year =          2017,
    Hour =          as.integer(substring(air17.edit$time, 1, 2)),
    Arrival =       as.integer(gsub(',', '', air17.edit$Arrival)),
    Departure =     as.integer(gsub(',', '', air17.edit$Departure)),
    TotalArrival =  as.integer(gsub(',','', air17.source$Arrival[length(air17.source$Arrival)])),
    TotalDeparture= as.integer(gsub( ',', '', air17.source$Departure[length(air17.source$Departure)]))
)
# 2018 air passenger data Seoul
air18.c <- data.frame(
    Year =          2018,
    Hour =          as.integer(substring(air18.edit$time, 1, 2)),
    Arrival =       as.integer(gsub(',', '', air18.edit$Arrival)),
    Departure =     as.integer(gsub(',', '', air18.edit$Departure)),
    TotalArrival =  as.integer(gsub( ',', '', air18.source$Arrival[length(air18.source$Arrival)])),
    TotalDeparture= as.integer(gsub( ',', '', air18.source$Departure[length(air18.source$Departure)]))
)

# combine air17 and air 18 into air.c
air.c <- rbind(air17.c, air18.c)
# adding relative calculations (percentage of total yearly arrivals/departures per hour)
ArrivalPct <- air.c$Arrival / air.c$TotalArrival
DeparturePct <- air.c$Departure / air.c$TotalDeparture
air.c <- cbind(air.c, ArrivalPct, DeparturePct)

head(air.c)
```

The air passenger data sets required a bit more attribute engineering. We first had to remove the 'TOTAL' row from both files (2017 & 2018). After that, we added a *Year* attribute to enable us to latter merge the two data sets. We then isolated a substring of the time description (used to be in the form of "00:00 ~ 00:59") to standardise the values to the same values found in the bike sharing data set ( integers from 0 to 23 ). We then had to replace "," characters found in the total *Arrival* and *Departure* counts before being able to cast them to integer. Further, two new attributes *TotalArrival* and *TotalDeparture* were added to both the 2017 and 2018 data which hold the total arrivals and departures per year respectively. This information will be used to calculate the percentage of arrivals/departures per hour compared to the total arrivals/departures per year.
The last step combined the two year 2017 and 2018 into one data frame *air.c*.

The next step will merge the air passenger information with the bike sharing data to create one data frame as the basis for further analysis and modelling.

```{r}

```


# Exploratory Analysis
```{r}

```

# Linear Modelling

```{r}

```

# Extended Modelling
```{r}

```

# [CHAPTER OF CHOICE] - Use package not mentioned in course (e.g. interactive 3D models?)
```{r}

```
